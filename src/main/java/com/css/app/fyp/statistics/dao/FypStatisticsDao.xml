<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.css.app.fyp.statistics.dao.FypStatisticsDao">

	<select id="queryObject" resultType="com.css.app.fyp.statistics.entity.FypStatistics">
		select * from FYP_STATISTICS where USER_ID = #{value}
	</select>

	<select id="queryList" resultType="com.css.app.fyp.statistics.entity.FypStatistics">
		select us.truename as userName,b.name as "PHRASENAME",us.account as "account",a.FINISHDAY as "finishDay", a.FINISHRATE as "finishRate",
		case a.role
		when 3 then (
		select name from base_app_organ where id =(
		select substr(tree_path,9,36) from base_app_organ where id = (
		select organid from base_app_user where user_id = a.user_id
		)
		))
		end divisionName,
		case a.role
		when 4 then (select name from base_app_organ where id = (select organid from base_app_user where user_id = a.user_id))
		end directorName,
		a.*
		from FYP_STATISTICS AS a
		left join FYP_STATISTICS_PHRASE as b on a.PHRASE_ID = b.id
        left join base_app_user as us on us.user_id = a.user_id
		where
		1=1
		<if test="userId != null and userId != null">
			and a.USER_ID =#{userId}
		</if>
	</select>

 	<select id="queryTotal" resultType="int">
		select count(*) from FYP_STATISTICS 
	</select>




	<insert id="save" parameterType="com.css.app.fyp.statistics.entity.FypStatistics">
		insert into FYP_STATISTICS
		(
			"ID", 
			"OVER_PERCENTAGE", 
			"DIVISION_NAME", 
			"CHECK_NUM", 
			"READKNOW_PERCENTAGE", 
			"FAST", 
			"PHRASE_ID", 
			"DOCUMENT_NUM", 
			"MEET_DAYS", 
			"CREATE_TIME", 
			"READPIECE_PERCENTAGE", 
			"DOCUMENT_NAME", 
			"DIRECTOR_NAME", 
			"DIVISION_ID", 
			"DOCUMENT_TYPE", 
			"READ_NUM", 
			"DIRECTOR_ID", 
			"RENDER_PERCENTAGE", 
			"DOPIECE_PERCENTAGE",
			"ONLINE_DAYS", 
			"ALREADY_NUM",
            "USER_ID",
            "ISREADTOTAL",
            "TOTAL",
            "FRISTDATE",
            "BJOverPercentage",
            "BJISREADTOTAL",
            "BJTOTAL",
            "YJOverPercentage",
            "YJISREADTOTAL",
            "YJTOTAL",
            "YZoverPercentage",
            "YZISREADTOTAL",
            "YZTOTAL",
			"ROLE",
			"FINISHDAY",
			"FINISHRATE"
		)
		values
		(
			#{id}, 
			#{overPercentage}, 
			#{divisionName}, 
			#{checkNum}, 
			#{readknowPercentage}, 
			#{fast},
			(select id from fyp_statistics_phrase where level = #{phraseId} and type = #{documentType}),
			#{documentNum}, 
			#{meetDays}, 
			#{createTime}, 
			#{readpiecePercentage}, 
			#{documentName}, 
			#{directorName}, 
			#{divisionId}, 
			#{documentType}, 
			#{readNum}, 
			#{directorId}, 
			#{renderPercentage}, 
			#{dopiecePercentage},
			#{onlineDays}, 
			#{alreadyNum},
            #{userId},
            #{ISREADTOTAL},
            #{TOTAL},
            #{FRISTDATE},
            #{BJOverPercentage},
            #{BJISREADTOTAL},
            #{BJTOTAL},
            #{YJOverPercentage},
            #{YJISREADTOTAL},
            #{YJTOTAL},
            #{YZoverPercentage},
            #{YZISREADTOTAL},
            #{YZTOTAL},
			#{ROLE},
			#{finishDay},
			#{finishRate}
		)
	</insert>
	
	<delete id="delete">
		delete from FYP_STATISTICS where ID = #{value}
	</delete>
	
	<delete id="deleteBatch">
		delete from FYP_STATISTICS where ID in 
		<foreach item="id" collection="array" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>


</mapper>